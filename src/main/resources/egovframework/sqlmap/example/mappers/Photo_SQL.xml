<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.sample.service.impl.PhotoMapper">
<select id="getPhotoBoardList" resultType="PhotoListGetVo">
SELECT a.iboard, a.title, a.created_at createdAt, a.VIEW
FROM board_tbl a
WHERE category = 2 AND a.title != '' AND a.contents != ''
<!--
<if test="name != null and name != ''">
AND name LIKE '%${name}%'
</if>
<if test="title != null and title != ''">
AND title LIKE '%${title}%'
</if>
-->
ORDER BY iboard DESC
LIMIT #{pageStart}, #{amount}
</select>

<!-- 페이지네이션에 사용할 게시글 총 개수 -->
<select id="getPhotoBoardListCnt" parameterType="Criteria" resultType="int">
SELECT COUNT(*)
FROM board_tbl
WHERE category = 2 AND title != '' AND contents != ''
	<if test="name != null and name != ''">
	AND NAME LIKE '%${name}%'
	</if>
	<if test="title != null and title != ''">
	AND title LIKE '%${title}%'
	</if>
ORDER BY iboard DESC
</select>

<insert id="insPhotoBoardNull" parameterType="PhotoInsNullDto" useGeneratedKeys="true" keyProperty="iboard">
INSERT INTO board_tbl(iuser, category, CODE, title, contents) VALUES(#{iuser}, #{category}, 0, '', '')
</insert>

<update id="updPhotoBoard" parameterType="PhotoUpdDto">
UPDATE board_tbl SET title = #{title}, contents = #{contents} WHERE iboard = #{iboard}
</update>

<select id="selPhotoBoard" parameterType="int" resultType="PhotoSelVo">
SELECT a.iboard, b.iuser, b.name, a.title, a.contents, a.created_at createdAt
FROM board_tbl a
INNER JOIN user_tbl b
ON a.iuser = b.iuser
WHERE a.iboard = #{iboard}
</select>

<insert id="insPhotoBoardFile" parameterType="BoardFileInsDto">
INSERT INTO file_tbl(iboard, original_name, saved_name, ext, file_size) VALUES(#{iboard}, #{originalName}, #{savedName}, #{ext}, #{fileSize})
</insert>
</mapper>